<div class="tmi_settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>TMI Generator Settings</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <!-- Extension 활성화 -->
            <label class="checkbox_label" for="tmi_extension_enabled">
                <input type="checkbox" id="tmi_extension_enabled" class="extension_enabled" checked />
                <span><strong>Extension 활성화</strong></span>
            </label>
            <small class="notes">TMI Generator를 활성화/비활성화합니다</small>

            <hr class="m-t-1 m-b-1">

            <!-- Generation Source -->
            <div>
                <label for="tmi_source">Generation Source</label>
                <small class="notes">TMI 생성에 사용할 API를 선택하세요</small>
            </div>
            <select id="tmi_source" class="text_pole source_select">
                <option value="main">Main API (현재 채팅 API)</option>
                <option value="profile">Connection Profile (별도 프로필)</option>
            </select>

            <!-- Connection Profile (조건부 표시) -->
            <div id="tmi_profile_settings" style="display: none; margin-top: 8px;">
                <label for="tmi_connection_profile">Connection Profile</label>
                <select id="tmi_connection_profile" class="text_pole connection_profile"></select>
            </div>

            <hr class="m-t-1 m-b-1">

            <!-- Auto-generate -->
            <label class="checkbox_label" for="tmi_auto_generate">
                <input type="checkbox" id="tmi_auto_generate" class="auto_generate" checked />
                <span>AI 답장 시 자동으로 TMI 생성</span>
            </label>

            <!-- Auto-open -->
            <label class="checkbox_label" for="tmi_auto_open">
                <input type="checkbox" id="tmi_auto_open" class="auto_open" />
                <span>생성된 TMI를 자동으로 펼쳐서 표시</span>
            </label>

            <hr class="m-t-1 m-b-1">

            <!-- TMI 개수 -->
            <div>
                <label for="tmi_count">TMI 개수</label>
                <small class="notes">생성할 TMI 항목 개수</small>
            </div>
            <select id="tmi_count" class="text_pole tmi_count">
                <option value="1">1개</option>
                <option value="2">2개</option>
                <option value="3" selected>3개</option>
                <option value="4">4개</option>
                <option value="5">5개</option>
                <option value="6">6개</option>
                <option value="7">7개</option>
                <option value="8">8개</option>
                <option value="9">9개</option>
                <option value="10">10개</option>
            </select>

            <!-- TMI 길이 -->
            <div>
                <label for="tmi_length">TMI 항목당 길이</label>
                <small class="notes">각 항목의 길이 제한</small>
            </div>
            <select id="tmi_length" class="text_pole tmi_length">
                <option value="short">짧게 (1-2줄)</option>
                <option value="medium" selected>중간 (3-5줄)</option>
                <option value="long">길게 (7줄 이상)</option>
            </select>

            <!-- TMI 언어 -->
            <div style="margin-top: 10px;">
                <label for="tmi_language">TMI 출력 언어</label>
                <small class="notes">생성될 TMI 항목의 언어</small>
            </div>
            <select id="tmi_language" class="text_pole tmi_language">
                <option value="en" selected>English</option>
                <option value="ko">한국어</option>
            </select>

            <!-- 최대 토큰 수 -->
            <div>
                <label for="tmi_max_tokens">최대 응답 토큰 수</label>
                <small class="notes">TMI 생성 시 사용할 최대 토큰 수 (기본 1500)</small>
            </div>
            <input id="tmi_max_tokens" type="number" class="text_pole max_tokens" min="0" max="7000" step="50" value="1500" />

            <!-- 컨텍스트 메시지 수 -->
            <div style="margin-top: 10px;">
                <label for="tmi_context_messages">컨텍스트 메시지 수</label>
                <small class="notes">TMI 생성 시 참고할 최근 메시지 개수 (기본 20개)</small>
            </div>
            <input id="tmi_context_messages" type="number" class="text_pole context_messages" min="5" max="50" step="5" value="20" />

            <hr class="m-t-1 m-b-1">

            <!-- TMI 생성 프롬프트 -->
            <div class="title_restorable">
                <label for="tmi_prompt">커스텀 프롬프트</label>
                <button class="menu_button fa-solid fa-undo interactable restore_prompt" title="기본 프롬프트로 복원"></button>
            </div>
            <small class="notes">어떤 종류의 TMI를 생성할지 설명합니다</small>

            <!-- 프롬프트 프리셋 -->
            <div style="display: flex; gap: 6px; margin-top: 6px; margin-bottom: 6px;">
                <select id="tmi_prompt_preset_select" class="text_pole prompt_preset_select" style="flex: 1;">
                    <!-- 프롬프트 프리셋 목록 -->
                </select>
                <button class="menu_button fa-solid fa-floppy-disk interactable prompt_preset_save" title="현재 프롬프트를 프리셋으로 저장"></button>
                <button class="menu_button fa-solid fa-trash interactable prompt_preset_delete" title="선택한 프롬프트 프리셋 삭제"></button>
            </div>

            <textarea id="tmi_prompt" class="text_pole textarea_compact prompt" rows="6"></textarea>

            <hr class="m-t-1 m-b-1">

            <!-- Custom CSS -->
            <div class="title_restorable">
                <label for="tmi_custom_css">Custom CSS</label>
                <button class="menu_button fa-solid fa-undo interactable restore_css" title="기본 CSS로 복원"></button>
            </div>

            <!-- CSS 프리셋 -->
            <div style="display: flex; gap: 6px; margin-top: 6px; margin-bottom: 6px;">
                <select id="tmi_css_preset_select" class="text_pole css_preset_select" style="flex: 1;">
                    <!-- CSS 프리셋 목록 -->
                </select>
                <button class="menu_button fa-solid fa-floppy-disk interactable css_preset_save" title="현재 CSS를 프리셋으로 저장"></button>
                <button class="menu_button fa-solid fa-trash interactable css_preset_delete" title="선택한 CSS 프리셋 삭제"></button>
            </div>

            <textarea id="tmi_custom_css" class="text_pole textarea_compact custom_css" rows="6"></textarea>

            <hr class="m-t-1 m-b-1">

            <!-- TMI 데이터 관리 -->
            <div>
                <label>TMI 데이터 관리</label>
                <small class="notes">저장된 TMI 데이터를 정리할 수 있습니다</small>
            </div>
            <div style="display: flex; gap: 6px; margin-top: 6px; margin-bottom: 10px;">
                <button class="menu_button interactable tmi_clear_current" style="flex: 1;">
                    현재 채팅방 TMI 초기화
                </button>
                <button class="menu_button interactable tmi_clear_all" style="flex: 1;">
                    전체 TMI 초기화
                </button>
            </div>
        </div>
    </div>
</div>
